<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=FEBnp3thsWeh6ykcxMYAPs9ZPLC0bFYV"></script>
    <title>校园行走最优路径查询系统 </title>
    <style type="text/css">
        html{height:100%}
        body{height:100%;margin:0px;padding:0px}
        #container{height:100%}
        button:focus{outline: none}
        button{
            background-color:blue;
            color:white;
            height:34px;
            border-color:blue;
            padding:5px;
        }
        select:focus{outline: none}
    </style>
</head>
<body>

<div id="container"></div>

</body>
</html>

<script>
    //数据主类
    function MapData() {
        this.marks=[];  //地图标注数组
        this.pointNames=[];  //名称数据
        this.pointPosition=[];  //位置数据
        this.pointArray=[];  //点数据
        this.distances=[];  //距离数组

        this.selectedPts=[];  //判断是否被选择，1是0否
        this.beginPoint=null;  //起点下标
        this.endPoint=null;  //终点下标
        this.isSelecting=0;  //判断是否正在选点状态

        this.planRoute=null;  //规划路线方法
        this.paintRoute=null;  //绘制路线方法
    }

    var mapData=new MapData();  //创建实例

    var map=new BMap.Map("container"); //地图类
    map.centerAndZoom(new BMap.Point(116.639757,23.41896),17);  //地图中心坐标
    map.enableScrollWheelZoom(true);  //启用滚轮缩放

    mapData.pointNames = //名称数组
        ["汕头大学长江艺术与设计学院-美术馆"
            , "汕头大学长江艺术与设计学院"
            , "汕头大学ACADEMICHOUSE"
            , "汕头大学旧体育馆"
            , "汕头地震台"
            , "汕头大学出版社"
            , "汕头大学内中国邮政"
            , "汕头大学内中国银行"
            , "汕头大学内幼儿园"
            , "大礼堂"
            , "汕头·香港大学联合病毒学研究所"
            , "馥香园"
            , "汕头大学附属小学"
            , "汕头大学附属中学"
            , "royalty皇茶"
            , "顺丰速运"
            , "近邻宝"
            , "图书馆"
            , "健客"
            , "真理钟"
            , "新体育馆"
            , "逸品潮"
            //,"汕头大学中心"
            , "汕头大学东南门"
            , "东门"
            , "汕头大学西南门"
            , "汕头大学东北门"
            , "汕头大学正门"
            , "第二/三饭堂"
            , "第四食堂"
            , "西苑餐厅"
            , "汕大学术交流楼餐厅"
            , "Mini外带寿司甜品简餐"
            , "米伦意式餐厅"
            , "五谷渔粉"
            , "明德书院"
            , "研究生院"
            , "敬一书院"
            , "知行书院"
            , "至诚书院"
            , "德馨书院"
            , "修远书院"
            , "思源书院"
            , "淑德书院"
            , "弘毅书院"
            , "莲花池"
            , "运动场"
            , "机电楼"
            , "科技楼"
            , "新行政楼"
            , "理学院"
            , "讲堂楼"
            , "文科楼"
            , "文学院"
            , "工科楼"
            , "法学院"
            , "汕头大学医学院(新校区)"
            , "汕头大学教学楼C座"
            , "汕头大学教学楼B座"
            , "汕头大学实验楼A座"
            , "汕头大学实验楼H座"
            , "汕头大学教学楼G座"
            , "汕头大学教学楼E座"
        ];
    mapData.pointPosition =  //坐标数组
        [[116.636673,23.424586]//汕头大学长江艺术与设计学院-美术馆-->
            ,[116.637042,23.424254]//汕头大学长江艺术与设计学院-->
            ,[116.647101,23.4154]//汕头大学ACADEMICHOUSE-->
            ,[116.637301,23.422297]//汕头大学旧体育馆-->
            ,[116.635837,23.421112]//汕头地震台-->
            ,[116.636623,23.420851]//汕头大学出版社-->
            ,[116.63682,23.42032]//汕头大学内中国邮政-->
            ,[116.636525,23.419834]//汕头大学内中国银行-->
            ,[116.637674,23.419383]//汕头大学内幼儿园-->
            ,[116.64023,23.419014]//大礼堂-->
            ,[116.63431,23.418376]//汕头·香港大学联合病毒学研究所-->
            ,[116.633447,23.417845]//馥香园-->
            ,[116.638323,23.416443]//汕头大学附属小学-->
            ,[116.638296,23.41629]//汕头大学附属中学-->
            ,[116.639843,23.417257]//royalty皇茶-->
            ,[116.640143,23.416117]//顺丰速运-->
            ,[116.640355,23.415536]//近邻宝-->
            ,[116.641959,23.416328]//图书馆-->
            ,[116.642043,23.415983]//健客-->
            ,[116.643308,23.416543]//真理钟-->
            ,[116.64539,23.415321]//新体育馆-->
            ,[116.639844,23.421469]//逸品潮
            //,[116.639757,23.41896]//汕头大学中心-->
            ,[116.647686,23.414787]//汕头大学东南门-->
            ,[116.64446,23.417386]//东门-->
            ,[116.634303,23.41649]//汕头大学西南门-->
            ,[116.644564,23.418745]//汕头大学东北门-->
            ,[116.644259,23.414779]//汕头大学正门
            ,[116.639655,23.421767]//第二/三饭堂-->
            ,[116.644133,23.418247]//第四食堂-->
            ,[116.635196,23.417158]//西苑餐厅-->
            ,[116.645719,23.415076]//汕大学术交流楼餐厅-->
            ,[116.638254,23.41887]//Mini外带寿司甜品简餐
            ,[116.641565,23.419579]//米伦意式餐厅
            ,[116.641003,23.415954]//五谷渔粉
            ,[116.638608,23.422683]//明德书院-->
            ,[116.639951,23.422488]//研究生院-->
            ,[116.639223,23.421472]//敬一书院-->
            ,[116.635005,23.417563]//知行书院-->
            ,[116.644479,23.418359]//至诚书院-->
            ,[116.644618,23.418492]//德馨书院-->
            ,[116.638952,23.421858]//修远书院-->
            ,[116.635905,23.416849]//思源书院-->
            ,[116.636116,23.425108]//淑德书院-->
            ,[116.639976,23.416957]//弘毅书院
            ,[116.639291,23.419329]//莲花池-->
            ,[116.638177,23.421376]//运动场-->
            ,[116.640454,23.421514]//机电楼-->
            ,[116.640441,23.421224]//科技楼-->
            ,[116.63992,23.420324]//新行政楼-->
            ,[116.641748,23.420643]//	理学院-->
            ,[116.641204,23.420332]//讲堂楼-->
            ,[116.640634,23.419744]//文科楼-->
            ,[116.640535,23.419557]//文学院-->
            ,[116.642342,23.4195]//工科楼-->
            ,[116.641529,23.419392]//法学院-->
            ,[116.640754,23.416058]//汕头大学医学院(新校区)-->
            ,[116.643751,23.419176]//汕头大学教学楼C座-->
            ,[116.643023,23.418956]//汕头大学教学楼B座-->
            ,[116.643356,23.418737]//汕头大学实验楼A座-->
            ,[116.643737,23.418877]//汕头大学实验楼H座-->
            ,[116.643778,23.418633]//汕头大学教学楼G座-->
            ,[116.642606,23.418127]//汕头大学教学楼E座-->
        ];
    mapData.distances=  //距离数组
        [
            [0,81,1658,304,573,532,588,681,733,763,1835,1835,1292,1301,1048,1271,1257,1189,1356,1225,1608,597,1763,1289,1738,1164,1635,626,1238,1674,1649,806,886,1187,286,599,538,1718,1177,1173,460,1594,64,1129,721,441,723,664,629,740,773,802,779,949,887,1183,1058,1082,1123,1088,1096,1104], //1
            [81,0,1554,200,469,428,484,577,629,659,1731,1731,1188,1197,944,1167,1153,1085,1252,1121,1504,493,1659,1185,1634,1060,1531,522,1134,1570,1545,702,782,1083,182,495,434,1614,1073,1069,356,1490,145,1025,617,337,619,560,525,635,669,698,675,845,783,1079,954,959,1000,984,992,1000], //2
            [1658,1554,1,1353,1519,1388,1341,1527,1283,843,1604,1604,1061,1070,887,1007,993,847,1014,883,251,1170,123,368,1507,607,588,1285,494,1443,211,1123,914,923,1446,1270,1208,1487,555,559,1197,1363,1723,879,970,1216,1221,1143,1006,994,1010,934,911,783,915,919,674,918,959,644,512,605], //3
            [304,200,1353,0,280,239,295,388,440,458,1542,1542,999,1008,755,966,952,884,1051,920,1303,292,1458,984,1445,934,1330,606,1008,1381,1344,513,581,882,266,579,233,1425,947,943,155,1301,369,838,416,136,418,359,324,501,468,497,474,651,582,878,828,758,799,858,819,799], //4
            [573,469,1519,280,0,121,177,270,322,697,1424,1424,881,890,637,925,911,1050,1217,1086,1469,650,1624,1150,1327,1239,1496,875,1227,1263,1510,395,820,841,535,848,591,1307,1252,1292,513,1183,638,718,470,494,776,717,563,859,826,736,713,890,821,837,1133,997,1038,1163,1058,965], //5
            [532,428,1388,239,121,0,33,123,191,566,1293,1293,750,759,506,794,780,919,1086,955,1338,609,1493,1019,1196,1108,1365,834,1096,1132,1379,264,689,710,494,807,550,1176,1121,1117,472,1052,597,587,339,453,735,676,432,818,681,605,582,759,690,706,1002,866,907,1032,927,834], //6
            [588,484,1341,295,177,33,0,90,144,519,1246,1246,703,712,459,747,733,872,1039,908,1291,633,1446,972,1149,1061,1318,890,1049,1085,1332,217,642,663,550,863,574,1129,1074,1070,528,1005,653,540,292,509,791,732,385,842,634,558,535,712,643,659,955,819,860,985,880,787], //7
            [681,577,1527,388,270,123,90,0,330,705,1432,1432,889,898,645,933,919,1058,1225,1094,1477,758,1632,1158,1335,1247,1504,983,1235,1271,1518,403,828,849,643,956,699,1315,1296,1256,621,1191,746,726,478,602,884,825,572,967,820,744,721,898,829,845,1141,1005,1046,1171,1066,973], //8
            [733,629,1283,440,322,191,144,330,0,461,1188,1188,645,654,401,689,675,814,981,850,1233,575,1388,914,1091,1003,1260,1035,991,1027,1274,159,584,605,695,1008,516,1071,1052,1012,495,947,798,482,234,514,701,642,328,784,576,500,477,654,585,601,897,761,802,927,822,729], //9
            [763,659,843,458,697,566,519,705,461,1,1053,1053,510,519,336,456,442,374,541,410,793,275,948,474,956,490,820,578,564,892,834,350,71,372,725,563,313,936,503,499,302,812,828,328,54,321,326,267,111,409,115,39,16,141,72,368,384,248,289,414,309,289], //10
            [1835,1731,1604,1542,1424,1293,1246,1432,1188,1053,0,0,542,533,745,1010,996,1135,1302,1171,1554,1380,1709,1235,371,1370,1427,1656,1312,160,1595,1028,1124,926,1797,1641,1428,116,1373,1377,1407,235,1900,724,1152,1426,1431,1372,1216,1365,1220,1144,1121,1075,1125,922,1264,1128,1169,1294,1189,1050], //11
            [1835,1731,1604,1542,1424,1293,1246,1432,1188,1053,0,0,542,533,745,1010,996,1135,1302,1171,1554,1380,1709,1235,371,1370,1427,1656,1312,160,1595,1028,1124,926,1797,1641,1428,116,1373,1377,1407,235,1900,724,1152,1426,1431,1372,1216,1365,1220,1144,1121,1075,1125,922,1264,1128,1169,1294,1189,1050], //12
            [1292,1188,1061,999,881,750,703,889,645,510,542,542,1,8,202,467,453,592,759,628,1011,837,1166,692,445,827,1038,1113,769,381,1052,485,581,383,1254,1098,885,425,830,834,864,301,1357,181,609,883,888,829,673,822,677,601,578,532,582,379,721,585,626,751,646,507], //13
            [1301,1197,1070,1008,890,759,712,898,654,519,533,533,8,1,211,476,462,601,768,637,1020,846,1175,701,436,836,1047,1122,778,372,1061,494,590,392,1263,1107,894,416,839,843,873,292,1366,190,618,892,897,838,682,831,686,610,587,541,591,388,730,594,635,760,655,516], //14
            [1048,944,887,755,637,506,459,645,401,336,745,745,202,211,0,293,279,418,585,454,837,663,992,518,648,653,864,939,595,584,878,242,407,209,1010,924,647,628,656,660,626,504,1113,86,365,645,714,655,458,648,503,427,404,358,408,205,547,411,452,577,472,333], //15
            [1271,1167,1007,966,925,794,747,933,689,456,1010,1010,467,476,293,0,2,538,705,574,957,783,1112,638,913,773,984,1059,715,849,998,529,527,83,1220,1044,831,893,776,782,810,769,1336,285,583,829,834,775,619,768,623,547,524,478,528,87,667,531,572,697,592,453], //16
            [1257,1153,993,952,911,780,733,919,675,442,996,996,453,462,279,2,0,524,691,560,943,769,1098,624,899,759,970,1045,701,835,984,515,513,69,1206,1030,817,879,762,766,796,755,1322,271,569,815,820,761,605,754,609,533,510,464,514,73,653,517,558,683,578,439], //17
            [1189,1085,847,884,1050,919,872,1058,814,374,1135,1135,592,601,418,538,524,1,106,200,797,701,952,478,1038,668,824,977,555,974,838,654,445,454,1138,962,739,1018,616,620,728,894,1254,410,501,747,752,693,537,686,541,465,442,396,446,450,585,449,490,615,510,293], //18
            [1356,1252,1014,1051,1217,1086,1039,1225,981,541,1302,1302,759,768,585,705,691,106,0,367,964,868,1119,645,1205,835,991,1144,722,1141,1005,821,612,621,1305,1129,916,1185,783,787,895,1061,1421,577,668,914,919,860,704,853,708,632,609,563,613,617,752,616,657,782,677,460], //19
            [1225,1121,883,920,1086,955,908,1094,850,410,1171,1171,628,637,454,574,560,200,367,0,833,737,988,514,1074,704,860,1013,591,1010,874,690,481,490,1174,998,785,1054,652,656,764,930,1290,446,537,783,788,729,573,722,577,501,478,432,482,486,621,485,526,651,546,329], //20
            [1608,1504,251,1303,1469,1338,1291,1477,1233,793,1554,1554,1011,1020,837,957,943,797,964,833,1,1120,375,336,1457,557,161,1235,444,1393,40,1073,864,873,1396,1220,1168,1437,505,509,1147,1313,1673,829,920,1166,1171,1093,956,944,960,884,861,733,865,869,624,868,909,594,462,555], //21
            [597,493,1170,292,650,609,633,758,575,275,1380,1380,837,846,663,783,769,701,868,737,1120,0,1275,801,1283,643,1147,0,717,1219,1161,464,398,699,540,364,39,1263,656,652,136,1139,662,655,340,155,51,16,248,210,177,235,258,428,399,695,537,561,602,567,575,616], //22
            [1763,1659,123,1458,1624,1493,1446,1632,1388,948,1709,1709,1166,1175,992,1112,1098,952,1119,988,375,1275,1,473,1482,712,454,1390,599,1548,335,1228,1019,1028,1551,1375,1313,1592,660,664,1302,1468,1828,984,1075,1321,1326,1248,1111,1099,1115,1039,1016,888,1020,1024,779,1023,1064,749,617,710], //23
            [1289,1185,368,984,1150,1019,972,1158,914,474,1235,1235,692,701,518,638,624,478,645,514,336,801,473,0,1138,238,363,916,125,1074,377,754,545,554,1077,901,849,1118,186,190,828,994,1354,510,601,847,852,774,637,625,641,565,542,414,546,550,305,549,590,275,143,236], //24
            [1738,1634,1507,1445,1327,1196,1149,1335,1091,956,371,371,445,436,648,913,899,1038,1205,1074,1457,1283,1482,1138,0,1273,1074,1559,1215,210,1498,931,1027,829,1700,1544,1331,254,1276,1280,1310,137,1803,627,1055,1329,1334,1275,1119,1268,1123,1047,1024,978,1028,825,1167,1031,1072,1197,1092,953], //25
            [1164,1060,607,934,1239,1108,1061,1247,1003,490,1370,1370,827,836,653,773,759,668,835,704,557,643,712,238,1273,1,584,716,112,1209,598,889,418,689,877,701,681,1253,51,1,778,1129,1229,645,617,797,694,574,653,425,657,581,558,214,417,685,105,348,389,75,67,426], //26
            [1635,1531,588,1330,1496,1365,1318,1504,1260,820,1427,1427,1038,1047,864,984,970,824,991,860,161,1147,454,363,1074,584,0,1855,471,1266,202,1100,891,900,1423,1247,1185,1310,532,536,1174,1193,1700,856,947,1193,1198,1120,983,971,987,911,888,760,892,896,651,895,936,621,489,582], //27
            [626,522,1285,606,875,834,890,983,1035,578,1656,1656,1113,1122,939,1059,1045,977,1144,1013,1235,0,1390,916,1559,716,1855,0,790,1495,1276,842,704,975,339,163,417,1539,729,725,514,1415,691,931,653,533,430,310,626,291,480,538,561,501,703,971,610,634,675,640,648,892], //28
            [1238,1134,494,1008,1227,1096,1049,1235,991,564,1312,1312,769,778,595,715,701,555,722,591,444,717,599,125,1215,112,471,790,0,1151,485,831,492,631,951,775,755,1195,61,64,852,1071,1303,587,691,871,768,648,727,499,731,642,619,288,491,627,179,422,463,149,17,313], //29
            [1674,1570,1443,1381,1263,1132,1085,1271,1027,892,160,160,381,372,584,849,835,974,1141,1010,1393,1219,1548,1074,210,1209,1266,1495,1151,1,1434,867,963,765,1636,1480,1267,43,1212,1216,1246,73,1739,563,991,1265,1270,1211,1055,1204,1059,983,960,914,964,761,1103,967,1008,1133,1028,889], //30
            [1649,1545,211,1344,1510,1379,1332,1518,1274,834,1595,1595,1052,1061,878,998,984,838,1005,874,40,1161,335,377,1498,598,202,1276,485,1434,1,1114,905,914,1437,1261,1209,1478,546,550,1188,1354,1714,870,961,1207,1212,1134,997,985,1001,925,902,774,906,910,665,909,950,635,503,596], //31
            [806,702,1123,513,395,264,217,403,159,350,1028,1028,485,494,242,529,515,654,821,690,1073,464,1228,754,931,889,1100,842,831,867,1114,1,473,445,768,827,405,911,892,896,384,787,871,322,123,403,590,531,217,673,465,389,366,543,474,441,783,647,688,813,708,569], //32
            [886,782,914,581,820,689,642,828,584,71,1124,1124,581,590,407,527,513,445,612,481,864,398,1019,545,1027,418,891,704,492,963,905,473,1,443,848,689,446,1007,431,427,425,883,951,399,198,444,449,390,234,413,238,162,139,70,1,439,312,176,217,342,237,360], //33
            [1187,1083,923,882,841,710,663,849,605,372,926,926,383,392,209,83,69,454,621,490,873,699,1028,554,829,689,900,975,631,765,914,445,443,1,1136,960,747,809,702,698,726,685,1252,201,499,745,750,691,535,684,539,463,440,394,444,3,583,447,488,613,508,369], //34
            [286,182,1446,266,535,494,550,643,695,725,1797,1797,1254,1263,1010,1220,1206,1138,1305,1174,1396,540,1551,1077,1700,877,1423,339,951,1636,1437,768,865,1136,0,312,500,1680,890,886,422,1556,351,1092,683,403,591,471,591,453,641,699,722,662,864,1132,771,795,836,801,809,1053], //35
            [599,495,1270,579,848,807,863,956,938,563,1641,1641,1098,1107,924,1044,1030,962,1129,998,1220,364,1375,901,1544,701,1247,163,775,1480,1261,827,689,960,312,0,402,1524,714,710,499,1400,664,916,638,518,415,295,611,277,465,523,546,486,688,956,595,619,660,625,633,877], //36
            [538,434,1208,233,591,550,606,699,516,313,1428,1428,885,894,647,831,807,739,916,785,1168,39,1313,849,1331,681,1185,417,755,1267,1209,405,446,747,500,402,1,1311,694,690,77,1177,603,703,281,96,165,106,189,248,215,273,296,466,447,743,575,599,640,605,613,654], //37
            [1718,1614,1487,1425,1307,1176,1129,1315,1071,936,116,116,425,416,628,893,879,1018,1185,1054,1437,1263,1592,1118,254,1253,1310,1539,1195,43,1478,911,1007,809,1680,1524,1311,1,1256,1260,1290,117,1783,607,1035,1309,1314,1255,1099,1248,1103,1027,1004,958,1008,805,1147,1011,1052,1177,1072,933], //38
            [1177,1073,555,947,1252,1121,1074,1260,1016,503,1373,1373,830,839,656,776,762,616,783,652,505,656,660,186,1276,51,532,729,61,1212,546,892,431,692,890,714,694,1256,0,3,791,1132,1242,648,630,810,707,587,666,438,670,594,571,227,430,688,118,361,402,88,43,374], //39
            [1173,1069,559,943,1248,1117,1070,1300,1056,499,1377,1377,834,843,660,780,766,620,787,656,509,652,664,190,1280,1,536,725,64,1216,550,896,427,698,886,710,690,1260,3,0,787,1136,1238,652,626,806,703,583,662,434,666,590,567,223,426,694,114,357,398,84,46,378], //40
            [460,356,1197,155,513,472,528,621,495,302,1407,1407,864,873,626,810,796,728,895,764,1147,136,1302,828,1310,778,1174,514,852,1246,1188,384,425,726,422,499,77,1290,791,787,0,1166,525,682,260,18,262,203,168,345,312,341,318,495,426,722,672,602,643,702,663,643], //41
            [1594,1490,1363,1301,1183,1052,1005,1191,947,812,235,235,301,292,504,769,755,894,1061,930,1313,1139,1468,994,137,1129,1193,1415,1071,73,1354,787,883,685,1556,1400,1177,117,1132,1136,1166,1,1659,483,911,1185,1190,1131,975,1124,979,903,880,834,884,681,1023,887,928,1053,948,809], //42
            [64,145,1723,369,638,597,653,746,798,828,1900,1900,1357,1366,1113,1336,1322,1254,1421,1290,1673,662,1828,1354,1803,1229,1700,691,1303,1739,1714,871,951,1252,351,664,603,1783,1242,1238,525,1659,0,1194,786,506,788,729,694,805,838,867,844,1014,952,1248,1123,1147,1188,1153,1161,1169], //43
            [1129,1025,879,838,718,587,540,726,482,328,724,724,181,190,86,285,271,410,577,446,829,655,984,510,627,645,856,931,587,563,870,322,399,201,1091,916,703,607,648,652,682,483,1194,0,446,701,706,647,491,640,495,419,396,350,400,197,539,403,444,569,464,325], //44
            [721,617,970,416,470,339,292,478,234,54,1152,1152,609,618,365,583,569,501,668,537,920,340,1075,601,1055,617,947,653,691,991,961,123,198,499,683,638,281,1035,630,626,260,911,786,455,1,279,401,342,92,484,190,114,91,268,199,495,511,375,416,541,436,416], //45
            [441,337,1216,136,494,453,509,602,514,321,1426,1426,883,892,645,829,815,747,914,783,1166,155,1321,847,1329,797,1193,533,871,1265,1207,403,444,745,403,518,96,1309,810,806,18,1185,506,701,279,0,281,222,187,364,331,360,337,514,445,741,691,621,662,721,682,662], //46
            [723,619,1221,418,776,735,791,884,701,326,1431,1431,888,897,714,834,820,752,919,788,1171,51,1326,852,1334,694,1198,430,768,1270,1212,590,449,750,591,415,165,1314,707,703,262,1190,788,706,401,281,0,68,374,261,228,286,309,479,450,746,588,612,653,618,626,667], //47
            [664,560,1143,359,717,676,732,825,642,267,1372,1372,829,838,655,775,761,693,860,729,1093,16,1248,774,1275,574,1120,310,648,1211,1134,531,390,691,471,295,106,1255,587,583,203,1131,729,647,342,222,68,1,315,141,169,227,250,359,391,687,468,492,533,498,506,608], //48
            [629,525,1006,324,563,432,385,571,327,111,1216,1216,673,682,458,619,605,537,704,573,956,248,1111,637,1119,653,983,626,727,1055,997,217,234,535,591,611,189,1099,666,662,168,975,694,491,92,187,374,315,0,457,226,150,127,304,235,531,547,411,452,577,472,452], //49
            [739,635,994,501,859,818,842,967,784,409,1365,1365,822,831,648,768,754,686,853,722,944,210,1099,625,1268,425,971,291,499,1204,985,673,413,684,452,276,248,1248,438,434,345,1124,804,640,484,364,261,141,457,0,311,369,392,210,412,680,319,343,384,349,357,601], //50
            [773,669,1010,468,826,681,634,820,576,115,1220,1220,677,686,503,623,609,541,708,577,960,177,1115,641,1123,657,987,480,731,1059,1001,465,238,539,641,465,215,1103,670,666,312,979,838,495,190,331,228,169,226,311,0,76,99,308,239,535,551,415,456,581,476,456], //51
            [802,698,934,497,736,605,558,744,500,39,1144,1144,601,610,427,547,533,465,632,501,884,235,1039,565,1047,581,911,538,642,983,925,389,162,463,699,523,273,1027,594,590,341,903,867,419,114,360,286,227,150,369,76,0,22,232,163,459,475,339,380,505,400,380], //52
            [779,675,911,474,713,582,535,721,477,16,1121,1121,578,587,404,524,510,442,609,478,861,258,1016,542,1024,558,888,561,619,960,902,366,139,440,741,546,296,1004,571,567,318,880,844,396,91,337,309,250,127,392,99,22,0,209,140,436,452,316,357,482,377,357], //53
            [949,845,783,651,890,759,712,898,654,141,1075,1075,532,541,358,478,464,396,563,432,733,428,888,414,978,214,760,501,288,914,774,543,70,394,662,486,466,958,227,223,495,834,1014,350,268,514,479,359,304,210,308,232,209,0,69,390,110,54,95,139,114,311], //54
            [887,783,915,582,821,690,643,829,585,72,1125,1125,582,591,408,528,514,446,613,482,865,399,1020,546,1028,417,892,703,491,964,906,474,1,444,849,688,447,1008,430,426,426,884,952,400,199,445,450,391,235,412,239,163,140,69,1,440,311,175,216,341,236,361], //55
            [1183,1079,919,878,837,706,659,845,601,368,922,922,379,388,205,87,73,450,617,486,869,695,1024,550,825,685,896,971,627,761,910,441,439,3,1132,956,743,805,698,694,722,681,1248,197,495,741,746,687,531,680,535,459,436,390,440,1,579,443,484,609,504,365], //56
            [1058,954,674,828,1133,1002,955,1141,897,384,1264,1264,721,730,547,667,653,585,752,621,624,537,779,305,1167,105,651,610,179,1103,665,783,312,583,771,595,575,1147,118,114,672,1023,1123,539,511,691,588,468,547,319,551,475,452,110,311,579,0,242,283,30,37,500], //57
            [1063,959,918,758,997,866,819,1005,761,248,1128,1128,585,594,411,531,517,449,616,485,868,561,1023,549,1031,348,895,634,422,967,909,647,176,447,795,619,599,1011,361,357,602,887,1128,403,375,621,612,492,411,343,415,339,316,54,175,443,242,0,41,272,60,364], //58
            [1104,1000,959,799,1038,907,860,1046,802,289,1169,1169,626,635,452,572,558,490,657,526,909,602,1064,590,1072,389,936,675,463,1008,950,688,217,488,836,660,640,1052,402,398,643,928,1169,444,416,662,653,533,452,384,456,380,357,95,216,484,283,41,0,313,19,405], //59
            [1088,984,644,858,1163,1032,985,1171,927,414,1294,1294,751,760,577,697,683,615,782,651,594,567,749,275,1197,75,621,640,149,1133,635,813,342,613,801,625,605,1177,88,84,702,1053,1153,569,541,721,618,498,577,349,581,505,482,139,341,609,30,272,313,0,7,463], //60
            [1096,992,512,819,1058,927,880,1066,822,309,1189,1189,646,655,472,592,578,510,677,546,462,575,617,143,1092,67,489,648,17,1028,503,708,237,508,809,633,613,1072,43,46,663,948,1161,464,436,682,626,506,472,357,476,400,377,114,236,504,37,60,19,7,0,331], //61
            [1104,1000,605,799,965,834,787,973,729,289,1050,1050,507,516,333,453,439,293,460,329,555,616,710,236,953,426,582,892,313,889,596,569,360,369,1053,877,664,933,374,378,643,809,1169,325,416,662,667,608,452,601,456,380,357,311,361,365,500,364,405,463,331,1] //62
        ];

    //创建点和标签
    for(let i=0; i<mapData.pointPosition.length; i++){
        mapData.pointArray[i] = new BMap.Point(mapData.pointPosition[i][0], mapData.pointPosition[i][1]);  // 创建点
        mapData.marks[i] = new BMap.Marker(mapData.pointArray[i]);
        addLabel(i);
        mapData.selectedPts[i]=0;
        mapData.marks[i].addEventListener("click",attribute);
    }
    //让所有点在视野范围内
    map.setViewport(mapData.pointArray);

    //标签点击事件
    function attribute(e){
        var p = e.target;
        for(let i=0; i<mapData.pointArray.length; i++){
            if(p.getPosition().lng===mapData.pointArray[i].lng&&p.getPosition().lat===mapData.pointArray[i].lat) {
                //alert(selectedPts[i]);
                mapData.selectedPts[i] = 1 - mapData.selectedPts[i];
            }
        }
        //alert("经纬度为：["+p.getPosition().lng+" ,"+p.getPosition().lat+"]。");
        refresh();
    }

    //刷新
    function refresh() {
        let showPage=document.getElementById("showPage");
        let content="";
        for(let i=0;i<mapData.pointArray.length;i++){
            if(mapData.selectedPts[i]===1){
                content+=mapData.pointNames[i]+"；<br>";
            }
        }
        showPage.innerHTML=content;
        let sel1=document.getElementById("sel1");
        let sel2=document.getElementById("sel2");
        while (sel1.options.length>0){
            sel1.remove(sel1.options.length-1);
            sel2.remove(sel2.options.length-1);
        }
        for (let i=0;i<mapData.pointNames.length;i++) {
            if (mapData.selectedPts[i] === 1) {
                let op = document.createElement("option");
                op.appendChild(document.createTextNode(mapData.pointNames[i]));
                let op2 = document.createElement("option");
                op2.appendChild(document.createTextNode(mapData.pointNames[i]));
                sel2.add(op2);
                sel1.add(op);

                op.selected=true;
                op2.selected=true;
                mapData.beginPoint=i;
                mapData.endPoint=i;
            }
        }
    }

    //补充标注说明
    function addLabel(i) {
        switch (mapData.pointNames[i]) {
            case "德馨书院":
            case "明德书院":
            case "淑德书院":
            case "修远书院":
            case "运动场":
            case "莲花池":
            case "至诚书院":
            case "弘毅书院":
            case "近邻宝":
                mapData.marks[i].setLabel(new BMap.Label(mapData.pointNames[i], {offset: new BMap.Size(20, -10)}));
        }  //添加说明标签
    }

    //添加比例尺控件
    var scale_control = new BMap.ScaleControl({
        anchor: BMAP_ANCHOR_BOTTOM_LEFT,
        offset:new BMap.Size(100,25)
    });
    map.addControl(scale_control);


    //主显示控件
    // 定义一个控件类,即function
    function ToolBar(){
        // 默认停靠位置和偏移量
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(25, 25);
    }

    // 通过JavaScript的prototype属性继承于BMap.Control
    ToolBar.prototype = new BMap.Control();

    // 自定义控件必须实现自己的initialize方法,并且将控件的DOM元素返回
    // 在本方法中创建个div元素作为控件的容器,并将其添加到地图容器中
    ToolBar.prototype.initialize = function(map){
        // 布局dom
        var div = document.createElement("div");
        var p1=document.createElement("h");
        div.appendChild(p1);
        p1.appendChild(document.createTextNode("校园行走最优路径查询系统 "));
        var bu=document.createElement("button");
        div.appendChild(bu);
        bu.appendChild(document.createTextNode("开始选择"));
        // 设置样式
        div.style.cursor = "pointer";
        div.style.backgroundColor = "white";
        div.style.boxShadow="3px 3px 6px 0px rgb(172, 172, 172)";
        div.style.width="300px";
        p1.style.padding="5px 10px 5px 15px";
        p1.style.float="left";
        p1.style.height="24px";
        bu.style.float="right";
        // 绑定事件
        bu.onclick = bclick;
        function bclick(){
            let i;
            if(mapData.isSelecting===0) {
                mapData.isSelecting = 1;
                bu.textContent = "收起面板";
                myChooseDig.show();
                for (i = 0; i < mapData.pointArray.length; i++) {
                    map.addOverlay(mapData.marks[i]);
                    addLabel(i);
                }
            }
            else {
                myChooseDig.hide();
                mapData.isSelecting = 0;
                bu.textContent = "开始选择";
                for (i = 0; i < mapData.pointPosition.length; i++)
                    map.removeOverlay(mapData.marks[i]);
            }
        }
        // 添加DOM元素到地图中
        map.getContainer().appendChild(div);
        // 将DOM元素返回
        return div;
    }
    // 创建控件
    var myToolBar = new ToolBar();
    // 添加到地图当中
    map.addControl(myToolBar);



    //选点用控件
    // 定义一个控件类,即function
    function ChooseDialog(){
        // 默认停靠位置和偏移量
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(25, 69);
    }

    //传入选好的点下标数组，返回排好序的点数组

    // 通过JavaScript的prototype属性继承于BMap.Control
    ChooseDialog.prototype = new BMap.Control();

    // 自定义控件必须实现自己的initialize方法,并且将控件的DOM元素返回
    // 在本方法中创建个div元素作为控件的容器,并将其添加到地图容器中
    ChooseDialog.prototype.initialize = function(map){
        // 创建一个DOM元素
        var div = document.createElement("div");
        //第一行
        var low1=document.createElement("div");
        var p1=document.createElement("h");
        div.appendChild(p1);
        p1.appendChild(document.createTextNode("起点："));
        var sel1=document.createElement("select");
        sel1.id="sel1";
        low1.appendChild(p1);
        low1.appendChild(sel1);
        div.appendChild(low1);
        //第二行
        var low2=document.createElement("div");
        var p2=document.createElement("h");
        div.appendChild(p2);
        p2.appendChild(document.createTextNode("终点："));
        var sel2=document.createElement("select");
        sel2.id="sel2";
        low2.appendChild(p2);
        low2.appendChild(sel2);
        div.appendChild(low2);
        //第三行
        var low3=document.createElement("div");
        var p3=document.createElement("h");
        var showPage=document.createElement("div");
        showPage.id="showPage";
        //p3.appendChild(document.createTextNode("已选择的点"));
        p3.innerHTML="已选择的点  <small style='color: darkgray'>点击标注进行选择/取消</small>";
        low3.appendChild(p3);
        low3.appendChild(showPage);
        div.appendChild(low3);
        //第四行
        var low4=document.createElement("div");
        var bu1=document.createElement("button");
        var bu2=document.createElement("button");
        bu1.appendChild(document.createTextNode("清空规划"));
        bu2.appendChild(document.createTextNode("开始规划"));
        low4.appendChild(bu1);
        low4.appendChild(bu2);
        div.appendChild(low4);
        // 设置样式
        div.style.cursor = "pointer";
        div.style.backgroundColor = "white";
        div.style.boxShadow="3px 3px 6px 0px rgb(172, 172, 172)";
        div.style.border="none";
        div.style.padding="10px"
        div.style.width="280px";
        div.style.height="400px";

        p1.style.display="inline-block";
        p1.style.margin="15px 5px";
        sel1.style.width="210px";
        sel1.style.float="right";
        sel1.style.margin="16px 5px";
        sel1.style.border="none";
        sel1.style.display="inline-block";
        sel1.style.fontSize="16px";
        sel1.style.height="19.8px";
        low1.style.borderBottom="1px solid gray";

        p2.style.display="inline-block";
        p2.style.margin="15px 5px";
        sel2.style.width="210px";
        sel2.style.float="right";
        sel2.style.margin="16px 5px";
        sel2.style.display="inline-block";
        sel2.style.fontSize="16px";
        sel2.style.border="none";
        sel2.style.height="19.8px";
        low2.style.borderBottom="1px solid gray";

        p3.style.display="block";
        p3.style.margin="15px 5px";
        low3.style.borderBottom="1px solid gray";
        low3.style.height="235px";
        showPage.style.height="190px";
        showPage.style.overflow="auto";
        showPage.style.wordBreak="break-word";

        low4.style.paddingTop="10px";
        bu1.style.margin="0 10%";
        bu1.style.width="30%";
        bu2.style.margin="0 10%";
        bu2.style.width="30%";

        //绑定事件
        showPage.addEventListener("mousemove",function () {
            map.disableScrollWheelZoom();  //禁用滚轮缩放
        })
        showPage.addEventListener("mouseout",function () {
            map.enableScrollWheelZoom();  //启用滚轮缩放
        })
        sel1.addEventListener("change",function (tx) {
            let text=this.options[this.options.selectedIndex].text;
            for(let i=0;i<mapData.pointArray.length;i++)
                if(mapData.pointNames[i]===text){
                    mapData.beginPoint=i;
                    break;
                }
        })
        sel2.addEventListener("change",function (tx) {
            let text=this.options[this.options.selectedIndex].text;
            for(let i=0;i<mapData.pointArray.length;i++)
                if(mapData.pointNames[i]===text){
                    mapData.endPoint=i;
                    break;
                }
        })
        bu1.addEventListener("click", function () {
            map.clearOverlays();
            for (let i = 0; i < mapData.pointArray.length; i++) {
                map.addOverlay(mapData.marks[i]);
                addLabel(i);
                mapData.selectedPts[i] = 0;
            }
            refresh();
        })
        bu2.addEventListener("click",function () {
            map.clearOverlays();
            for(let i=0;i<mapData.pointArray.length;i++){
                map.addOverlay(mapData.marks[i]);
                addLabel(i);
            }
            mapData.paintRoute(mapData.planRoute(),map);
        })

        // 添加DOM元素到地图中
        map.getContainer().appendChild(div);
        // 将DOM元素返回
        return div;
    }
    // 创建控件
    // 添加到地图当中
    var myChooseDig=new ChooseDialog();
    map.addControl(myChooseDig);
    myChooseDig.hide();


    //计算距离数组,distances[i][j] i为行j为列

    /*   document.getElementById("show").style.overflow="auto";
       document.getElementById("show").style.wordBreak="break-word";
       var ii=15,jj=0,count=0,count2=0,count3,dd=15;
       var distance="[";
       var walking = new BMap.WalkingRoute(map, {renderOptions:{map: map, autoViewport: true}});  //步行实例
       walking.setSearchCompleteCallback(function(){
           count++;
           count2++;
           distance += walking.getResults().getPlan(0).getDistance(false);    //通过实例，获得一系列点的数组
           if(count!==62) {
               distance += ",";    //通过实例，获得一系列点的数组
           }else {
               count3++;
               distance += "],  //"+count3 + "<br>" + "[";
           }
           document.getElementById("show").innerHTML=distance;
           document.getElementById("co").innerHTML=count2.toString();
           if(ii<62) {
               if (count === 62) {
                   walking.search(pointArray[++ii], pointArray[0]);
                   jj = 1;
                   count = 0;
               } else walking.search(pointArray[ii], pointArray[jj++]);
           }
       });
       count3=dd;
       walking.search(pointArray[ii],pointArray[jj++]);*/





    //结点类
    function Node(value) {
        this.value=value;  //值，为pointArray的下标
        this.next=null;  //下一项
    }
    //链表类
    function LinkList() {
        this.head=new Node(999);
        this.find=function(i) {  //寻找链表中的第i项
            let c=0;
            let currNode=this.head;
            while(c<i){
                currNode=currNode.next;
                c++;
            }
            return currNode;
        };
        this.insert=function(i,value) {  //在链表的第i项后插入value
            let p=this.find(i);
            let newNode=new Node(value);
            newNode.next=p.next;
            p.next=newNode;
        };
        this.remove=function(i) {  //删除第i项
            let p=this.find(i-1);
            p.next=this.find(i + 1);
        };
        this.length=function() {  //链表长度
            let c=0;
            let h=this.head;
            while (h.next!=null){
                h=h.next;
                c++;
            }
            return c;
        };
        this.push=function(item) {  //在链表尾加入item
            let newNode = new Node(item);
            let p = this.head;
            while (p.next !== null) {
                p = p.next;
            }
            p.next = newNode;
        };
    }
    //绘制路线
    mapData.paintRoute=function(result,map) {
        let distances=this.distances;
        let pointArray=this.pointArray;
        let points = result[0];
        let seq = result[1];
        //27:二三饭，28：四饭，29：西苑
        let minA = 0, minB = 0;
        let minDistance = 10000;
        for (let i = 0; i < points.length; i++) {
            let d = seq[i];
            for (let j = 27; j < 30; j++) {
                if (minDistance >= distances[d][j]) {
                    minDistance = distances[d][j];
                    minA = d;
                    minB = j;
                }
            }
        }
        let ii = 0;  //下标
        let jj = 0;  //需要重新连上的点的下标
        let lastPoint = null;  //上一次规划的最后一个点
        let breakPoint = [];  //需要重新连上的点数组
        let walking = new BMap.WalkingRoute(map, {renderOptions: {map: map, autoViewport: true}});  //步行实例
        let walk = new BMap.WalkingRoute(map, {renderOptions: {map: map, autoViewport: true}});  //步行实例

        walk.setSearchCompleteCallback(function () {
            let pts = walk.getResults().getPlan(0).getRoute(0).getPath();    //通过实例，获得一系列点的数组
            let polyline = new BMap.Polyline(pts);  //画线
            polyline.enableMassClear();
            polyline.setStrokeStyle("dashed");
            polyline.setStrokeColor("orange");
            map.addOverlay(polyline);
            walk.clearResults();   //清除导航结果
            //alert(pointNames[minA]+","+pointNames[minB]);
        })

        walking.setSearchCompleteCallback(function () {
            let pts = walking.getResults().getPlan(0).getRoute(0).getPath();    //通过实例，获得一系列点的数组
            let polyline = new BMap.Polyline(pts);  //画线
            polyline.enableMassClear();
            map.addOverlay(polyline);
            walking.clearResults();   //清除导航结果
            if (ii <= points.length - 1 && lastPoint !== null && pts[0] !== lastPoint) { //判断主路线还没画完、不是第一条主路线、当前路线的第一个点不等于上一条路线的最后一个点，则把点加到需要重新连上的点数组中
                /*let m1 = new BMap.Marker(lastPoint);
                let m2 = new BMap.Marker(pts[0]);
                map.addOverlay(m1);
                map.addOverlay(m2);*/
                breakPoint.push(lastPoint);
                breakPoint.push(pts[0]);
                if (ii === points.length - 1) ii++;
            }
            //alert(ii.toString()+breakPoint.length.toString());
            lastPoint = pts[pts.length - 1];  //更新上一次规划的最后一个点
            if (ii < points.length - 1) {  //主路线没画完，优先画主路线
                walking.search(points[ii++], points[ii]);  //按顺序导航
            }
            if (ii === points.length && jj < breakPoint.length - 1) {  //主路线画完且需要重新连上的路线没画完
                walking.search(breakPoint[jj], breakPoint[jj + 1]);
                jj += 2;
            }
            if (jj === breakPoint.length) {
                walk.search(pointArray[minA], pointArray[minB]);
            }
        });
        for (let i = 0; i < points.length; i++) {
            let label;
            if (points[i].lng === points[0].lng && points[i].lat === points[0].lat && i !== 0)
                label = new BMap.Label(1 + "," + (i + 1), {position: points[i]});
            else label = new BMap.Label(i + 1, {position: points[i]});
            label.setStyle({
                fontSize: "14px"
            })
            map.addOverlay(label);  //加顺序标签
        }
        walking.search(points[ii++], points[ii]);  //第一条主路线
    }

    //规划路线
    mapData.planRoute=function() {
        let pointArray=this.pointArray;
        let selectedPts=this.selectedPts;
        let distances=this.distances;
        let lineList = new LinkList();  //存已连好的点的链表
        let pointsList = new LinkList();  //存要放的点的链表

        for (let i = 0; i < pointArray.length; i++) {
            if (selectedPts[i] === 1 && i !== this.beginPoint && i !== this.endPoint)
                pointsList.push(i);
        }
        lineList.push(this.beginPoint);
        lineList.push(this.endPoint);
        let remain = pointsList.length();  //剩余未加点数
        let complete = lineList.length();  //已完成点数
        while (remain > 0) {
            let min = 9999;
            let v = null; //插入点值
            let vo = null;  //插入点原位置
            let io = null;  //要插入的位置
            for (let i = 1; i <= remain; i++) {
                for (let j = 1; j < complete; j++) {
                    let n = pointsList.find(i);
                    let dist = distances[n.value][lineList.find(j).value] + distances[n.value][lineList.find(j + 1).value];
                    if (dist < min) {
                        min = dist;
                        vo = i;
                        v = n.value;
                        io = j;
                    }
                }
            }
            pointsList.remove(vo);
            lineList.insert(io, v);
            remain = pointsList.length();  //刷新
            complete = lineList.length();  //刷新
        }

        let result = [];  //结果数组
        result[0] = [];
        result[1] = [];
        let p = lineList.head.next;
        while (p != null) {
            result[0].push(pointArray[p.value]);  //point变量
            result[1].push(p.value);  //point的下标
            p = p.next;
        }
        return result;
    }



</script>